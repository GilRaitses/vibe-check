# Implementation Plan: Integrating TensorFlow.js and Bike Detection

## Date: 2025-06-21

### Overview
This document outlines the steps to integrate TensorFlow.js and a pre-trained object detection model (COCO-SSD) into the test-safety-app. The goal is to detect bikes on sidewalks using the device camera and update safety scores for each block on the map.

---

## Steps

1. **Set Up Camera Functionality**
   - [x] Add a Camera screen using `expo-camera`.
   - [x] Allow users to capture images and display the result.

2. **Integrate TensorFlow.js**
   - [x] Install `@tensorflow/tfjs` and `@tensorflow/tfjs-react-native`.
   - [x] Initialize TensorFlow.js in the app.
   - [x] Load the COCO-SSD pre-trained model for object detection.

3. **Run Bike Detection on Captured Images**
   - [x] Convert the captured image to a tensor.
   - [x] Run the image through the COCO-SSD model.
   - [x] Parse the results to count detected bikes.

4. **Display Detection Results**
   - [x] Show the number of detected bikes on the Camera screen.
   - [x] Overlay bounding boxes on detected bikes.

5. **Update Safety Scores on the Map**
   - [x] Associate detection results with the user's current location/block.
   - [x] Update the safety score for the relevant block on the map.

---

## Progress Update (TensorFlow.js Integration)
- The Camera screen now integrates TensorFlow.js and the COCO-SSD model.
- After taking a picture, the app runs bike detection and displays the number of detected bikes.
- A loading indicator is shown while processing.
- Error handling is in place for detection failures.

## Progress Update (Bounding Box Visualization)
- Red bounding boxes are drawn over detected bikes in the captured image.
- Boxes are scaled to match the displayed image dimensions.
- Detection results are clearly displayed with bike count.

## Progress Update (Map Integration)
- Created a shared SafetyContext to manage safety data between screens.
- Safety Map now shows dynamic safety scores with color-coded markers.
- Camera screen can update safety scores that immediately reflect on the map.
- Added a safety legend and test update functionality.
- Safety scores are calculated as: 10 - bike_count (10 = safe, 1 = dangerous).

## Features Completed
- ✅ Camera capture with bike detection
- ✅ Bounding box visualization
- ✅ Real-time safety score updates
- ✅ Color-coded map markers (Green=Safe, Orange=Moderate, Red=Dangerous)
- ✅ Shared state management between Camera and Map screens
- ✅ Test functionality for demonstration

## Next Steps
- Test detection accuracy and performance on a real device.
- Add location-based block identification (GPS integration).
- Implement data persistence for safety scores.
- Add user authentication and community reporting features.

## Technical Implementation Details
- **TensorFlow.js**: Using COCO-SSD model for object detection
- **State Management**: React Context for shared safety data
- **Map Integration**: react-native-maps with dynamic markers
- **Image Processing**: Base64 encoding for TensorFlow.js compatibility
- **Safety Scoring**: Inverse relationship with bike count (more bikes = lower safety) 