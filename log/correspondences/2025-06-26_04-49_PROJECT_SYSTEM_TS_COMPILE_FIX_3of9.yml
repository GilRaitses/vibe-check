# =========================================================================
# TYPESCRIPT COMPILATION FIX MISSION
# Agent Assignment: Code Quality & Build System Specialist
# Priority: BLOCKING - Prevents All Deployments
# =========================================================================

agent_assignment:
  mission_id: "TYPESCRIPT_COMPILATION_FIX"
  agent_role: "Code Quality & Build Specialist"
  priority: "BLOCKING"
  deadline: "IMMEDIATE"
  complexity: "LOW"
  estimated_duration: "30-60 minutes"

# =========================================================================
# MISSION BRIEFING
# =========================================================================

mission_objective: |
  Fix TypeScript compilation errors that are preventing deployment of both
  the Phase 3 alert system and pedestrian route analyzer. These are blocking
  issues that must be resolved before any other agent can deploy their work.

blocking_impact:
  phase_3_alerts: "Cannot deploy alert functions due to compilation errors"
  pedestrian_routes: "Cannot deploy route analyzer due to compilation errors"
  overall_system: "Entire Firebase Functions deployment blocked"
  business_impact: "No new features can be deployed to production"

current_error_analysis:
  error_count: "7+ TypeScript compilation errors"
  error_types: "Return value issues, unused variables, type safety"
  affected_files: "src/index.ts, src/pedestrianRouteService.ts"
  build_command: "npm run build (currently failing)"

# =========================================================================
# SPECIFIC ERRORS TO FIX
# =========================================================================

error_1_index_ts_return_values:
  file: "src/index.ts"
  error_lines:
    - "Line 1570: error TS7030: Not all code paths return a value"
    - "Line 1722: error TS7030: Not all code paths return a value"
  
  problem_analysis: "Functions declared with return types but missing return statements"
  
  fix_strategy:
    option_1: "Add explicit return statements"
    option_2: "Change function return type to void"
    option_3: "Add return statements in all code paths"
  
  recommended_fix: "Add explicit return statements or void types"
  
  example_fix: |
    // Before (causing error)
    function someFunction(): boolean {
      if (condition) {
        return true;
      }
      // Missing return statement here
    }
    
    // After (fixed)
    function someFunction(): boolean {
      if (condition) {
        return true;
      }
      return false; // Explicit return added
    }

error_2_pedestrian_route_service_unused_variables:
  file: "src/pedestrianRouteService.ts"
  errors:
    - "Line 30: 'RLState' is declared but never used"
    - "Line 51: 'thresholds' is declared but its value is never read"
    - "Line 79: 'epsilon' is declared but its value is never read"
    - "Line 80: 'bigquery' is declared but its value is never read"
    - "Line 112: 'PedestrianEnergyModel' is declared but never used"
  
  problem_analysis: "Unused variables and interfaces causing compilation warnings/errors"
  
  fix_strategy:
    remove_unused: "Delete unused variables and interfaces"
    comment_out: "Comment out unused code for future use"
    use_variables: "Actually implement the unused variables"
    suppress_warnings: "Add TypeScript suppress comments"
  
  recommended_fix: "Remove unused variables and interfaces"
  
  example_fixes: |
    // Remove unused interface
    // interface RLState { ... }  // DELETE THIS
    
    // Remove unused variables
    // const thresholds = { ... }; // DELETE THIS
    // const epsilon = 0.1;        // DELETE THIS
    // const bigquery = new BigQuery(); // DELETE THIS
    
    // Remove unused class
    // class PedestrianEnergyModel { ... } // DELETE THIS

# =========================================================================
# TASKS TO EXECUTE
# =========================================================================

task_1_identify_all_errors:
  objective: "Get complete list of TypeScript compilation errors"
  
  commands:
    check_build: "cd functions && npm run build 2>&1 | tee build-errors.log"
    analyze_errors: "cat build-errors.log | grep 'error TS'"
    count_errors: "cat build-errors.log | grep 'error TS' | wc -l"
  
  deliverable: "Complete list of all TypeScript errors with line numbers"

task_2_fix_index_ts_errors:
  objective: "Fix return value errors in src/index.ts"
  
  approach:
    locate_functions: "Find functions at lines 1570 and 1722"
    analyze_logic: "Determine what these functions should return"
    add_returns: "Add appropriate return statements"
    verify_fix: "Ensure all code paths have returns"
  
  validation:
    compile_test: "npm run build should not show index.ts errors"
    function_test: "Functions should work correctly with new returns"

task_3_fix_pedestrian_service_errors:
  objective: "Clean up unused variables in src/pedestrianRouteService.ts"
  
  approach:
    remove_unused_interface: "Delete RLState interface if truly unused"
    remove_unused_variables: "Delete thresholds, epsilon, bigquery variables"
    remove_unused_class: "Delete PedestrianEnergyModel class if unused"
    verify_no_references: "Ensure removed items aren't used elsewhere"
  
  validation:
    compile_test: "npm run build should not show pedestrianRouteService.ts errors"
    functionality_test: "Service should still work after cleanup"

task_4_verify_complete_fix:
  objective: "Ensure all TypeScript errors are resolved"
  
  verification_commands:
    clean_build: "npm run build"
    check_success: "echo $? # Should be 0 for success"
    verify_output: "npm run build should show 'Compilation complete'"
  
  success_criteria:
    zero_errors: "npm run build completes with 0 errors"
    zero_warnings: "Minimal or no TypeScript warnings"
    clean_output: "Build output shows successful compilation"

task_5_test_function_deployment:
  objective: "Verify functions can be deployed after fixes"
  
  test_commands:
    dry_run_deploy: "firebase deploy --only functions --dry-run"
    validate_functions: "firebase functions:list"
  
  success_criteria:
    deployment_ready: "Dry run shows no compilation errors"
    function_validation: "All functions validate successfully"

# =========================================================================
# TROUBLESHOOTING GUIDE
# =========================================================================

common_typescript_issues:
  return_value_errors:
    cause: "Function signature promises return value but doesn't always return"
    solution: "Add return statements in all code paths or change to void"
    
  unused_variable_errors:
    cause: "Variables declared but never used (strict TypeScript settings)"
    solution: "Delete unused variables or use them"
    
  type_mismatch_errors:
    cause: "Variable types don't match usage"
    solution: "Fix type annotations or variable usage"

debugging_commands:
  verbose_compilation: "npx tsc --noEmit --verbose"
  specific_file_check: "npx tsc --noEmit src/index.ts"
  type_checking_only: "npx tsc --noEmit"

# =========================================================================
# VALIDATION REQUIREMENTS
# =========================================================================

validation_checklist:
  compilation_success:
    - [ ] "npm run build completes successfully"
    - [ ] "Exit code 0 from build command"
    - [ ] "No TypeScript errors in output"
    - [ ] "Minimal warnings (< 5)"
  
  functionality_preservation:
    - [ ] "Alert processor functions still work"
    - [ ] "Pedestrian route service still works"
    - [ ] "No runtime errors introduced"
    - [ ] "All existing functionality preserved"
  
  deployment_readiness:
    - [ ] "Firebase deployment dry-run succeeds"
    - [ ] "Functions validate successfully"
    - [ ] "Ready for production deployment"

# =========================================================================
# EVIDENCE REQUIREMENTS
# =========================================================================

before_evidence:
  - "Screenshot of npm run build showing errors"
  - "Complete error log with line numbers"
  - "Count of total TypeScript errors"

after_evidence:
  - "Screenshot of successful npm run build"
  - "Clean compilation output"
  - "Firebase deployment dry-run success"

code_changes:
  - "Git diff showing exact changes made"
  - "List of files modified"
  - "Explanation of each fix applied"

# =========================================================================
# SUCCESS CRITERIA
# =========================================================================

technical_success:
  clean_compilation: "npm run build completes with 0 errors"
  preserved_functionality: "All existing features still work"
  deployment_ready: "Firebase Functions ready for deployment"

process_success:
  quick_resolution: "Fixed within 60 minutes"
  minimal_changes: "Only necessary changes made"
  documented_fixes: "Clear explanation of what was fixed"

unblocking_success:
  phase_3_ready: "Alert system can now be deployed"
  pedestrian_ready: "Route analyzer can now be deployed"
  development_unblocked: "Team can continue development"

# =========================================================================
# ESCALATION TRIGGERS
# =========================================================================

escalate_if:
  - "Compilation errors persist after 3 fix attempts"
  - "Fixes break existing functionality"
  - "New errors introduced by fixes"
  - "Cannot determine root cause of errors"

escalation_process:
  step_1: "Document all attempted fixes"
  step_2: "Provide complete error logs"
  step_3: "Request senior developer review"
  step_4: "Consider alternative build approaches"

# =========================================================================
# FINAL MISSION STATEMENT
# =========================================================================

mission_statement: |
  Fix TypeScript compilation errors that are blocking all Firebase Functions
  deployments. This is a critical blocking issue that prevents other agents
  from deploying their work. Success means clean compilation and unblocked
  development.

success_definition: "CLEAN_TYPESCRIPT_COMPILATION_ENABLING_DEPLOYMENTS"
accountability: "PROVIDE_BEFORE_AND_AFTER_BUILD_EVIDENCE"
timeline: "COMPLETE_WITHIN_60_MINUTES"
priority_level: "BLOCKING_ALL_OTHER_WORK"
