<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibecheck NYC - Live Demo Presentation</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: #2d3748;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            scroll-behavior: smooth;
        }

        .section {
            min-height: 100vh;
            padding: 4rem 2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: rgba(255, 255, 255, 0.95);
            margin-bottom: 2px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: #1a202c;
        }

        h3 {
            font-size: 1.8rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: #2d3748;
        }

        .timestamp {
            font-size: 0.9rem;
            color: #718096;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .talk-text {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            color: #4a5568;
            max-width: 800px;
        }

        .demo-interface {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }

        .map-container {
            height: 600px;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .borough-btn {
            background: #f7fafc;
            color: #2d3748;
            border: 1px solid #e2e8f0;
        }

        .borough-btn.active {
            background: #667eea;
            color: white;
        }

        .zone-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .zone-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .temperature-score {
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            padding: 2rem;
            border-radius: 12px;
            color: white;
            margin: 1rem 0;
        }

        .score-hot { background: linear-gradient(45deg, #ff6b6b, #ee5a24); }
        .score-warm { background: linear-gradient(45deg, #ffa726, #ff7043); }
        .score-cool { background: linear-gradient(45deg, #42a5f5, #1e88e5); }
        .score-cold { background: linear-gradient(45deg, #26c6da, #00acc1); }

        .vision-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .indicator-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .formula-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid #e9ecef;
        }

        .gemini-interface {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 2rem;
            color: white;
            margin-top: 2rem;
        }

        .chat-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .chat-input {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 6px;
            margin-top: 1rem;
            font-size: 1rem;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            color: #2d3748;
        }

        .status-online { border-left: 4px solid #48bb78; }
        .status-error { border-left: 4px solid #f56565; }
        .status-warning { border-left: 4px solid #ed8936; }

        .hover-popup {
            position: absolute;
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .hover-popup.show {
            opacity: 1;
        }

        .bigquery-viz {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 768px) {
            .section { padding: 2rem 1rem; }
            h1 { font-size: 2.5rem; }
            h2 { font-size: 2rem; }
            .zone-dashboard { grid-template-columns: 1fr; }
            .vision-breakdown { grid-template-columns: 1fr; }
        }

        .pipeline-step {
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .step-label {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .step-status {
            font-size: 0.7rem;
            color: #666;
        }
        
        .pipeline-step.active .step-circle {
            background: #4285f4;
            color: white;
            transform: scale(1.1);
        }
        
        .pipeline-step.completed .step-circle {
            background: #34a853;
            color: white;
        }
        
        .pipeline-step.error .step-circle {
            background: #ea4335;
            color: white;
        }
        
        .processing-item {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-left: 3px solid #4285f4;
        }
        
        .analysis-item {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 3px solid #34a853;
        }
        
        .raw-output {
            background: #f5f5f5;
            border-radius: 4px;
            padding: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 0.5rem;
        }
        
        .expand-button {
            background: none;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Hero Section [00:00] -->
    <section class="section" id="hero">
        <div class="container">
            <div class="timestamp">[00:00] Introduction</div>
            <h1>Vibecheck NYC</h1>
            <div class="talk-text">
                <p>This is a real-time urban sensing system built with Google Cloud AI tools. It monitors public space across New York City using traffic camera feeds and generates a live surface of ambient pressure conditions.</p>
                <p><strong>Vibecheck reads the emotional temperature of the city, block by block, in motion.</strong></p>
            </div>
            
            <div class="demo-interface">
                <h3>Live NYC Emotional Temperature Map</h3>
                <div class="controls">
                    <button class="btn btn-primary" onclick="refreshMap()">Refresh Live Data</button>
                    <button class="borough-btn active" onclick="filterBorough('all')">All NYC</button>
                    <button class="borough-btn" onclick="filterBorough('MN')">Manhattan</button>
                    <button class="borough-btn" onclick="filterBorough('BK')">Brooklyn</button>
                    <button class="borough-btn" onclick="filterBorough('QN')">Queens</button>
                    <button class="borough-btn" onclick="filterBorough('BX')">Bronx</button>
                    <button class="borough-btn" onclick="filterBorough('SI')">Staten Island</button>
                </div>
                <div id="main-map" class="map-container"></div>
                <p style="margin-top: 1rem; color: #718096; font-size: 0.9rem;">
                    Click any zone to select it for detailed analysis below. Hover for quick preview.
                </p>
            </div>
        </div>
    </section>

    <!-- Technical Architecture [00:30] -->
    <section class="section" id="architecture">
        <div class="container">
            <div class="timestamp">[00:30] Technical Architecture</div>
            <h2>Voronoi Zones & AI Processing Pipeline</h2>
            <div class="talk-text">
                <p>Each zone is generated from a Voronoi map based on camera placement and borough geometry. Images stream through a proxy server and are processed using Cloud Vision.</p>
                <p><strong>Gemini then interprets each frame using a configuration of ambient tension indicators.</strong></p>
            </div>

            <div class="demo-interface">
                <h3>Zone Explorer - Select any zone above to analyze</h3>
                <div id="selected-zone-info">
                    <p style="text-align: center; color: #718096; padding: 2rem;">
                        Select a zone from the map above to see detailed analysis
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Zone Dashboard [01:00] -->
    <section class="section" id="dashboard">
        <div class="container">
            <div class="timestamp">[01:00] Adaptive Monitoring & Dashboard</div>
            <h2>Real-Time Zone Analysis</h2>
            <div class="talk-text">
                <p>The system determines adaptive monitoring frequency. It increases resolution in areas of instability and zooms into quiet pockets inside tense zones.</p>
                <p><strong>These scores are logged in BigQuery for longitudinal modeling and visualized through Firebase.</strong></p>
            </div>

            <div class="demo-interface">
                <div id="zone-dashboard" class="zone-dashboard">
                    <div class="zone-info">
                        <h4>Current Frame Analysis</h4>
                        <div id="current-frame">
                            <div style="background: #f1f3f4; height: 200px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #5f6368;">
                                Select a zone to view live feed
                            </div>
                        </div>
                        <div id="monitoring-frequency" style="margin-top: 1rem;">
                            <strong>Monitoring Frequency:</strong> <span id="freq-value">--</span>
                        </div>
                    </div>
                    <div class="zone-info">
                        <h4>Emotional Temperature</h4>
                        <div id="temperature-display" class="temperature-score score-cool">
                            <div id="temp-value">--</div>
                            <div style="font-size: 1rem; font-weight: 400;">Ambient Pressure</div>
                        </div>
                        <div id="zone-details">
                            <p><strong>Zone:</strong> <span id="zone-id">--</span></p>
                            <p><strong>Borough:</strong> <span id="zone-borough">--</span></p>
                            <p><strong>Cameras:</strong> <span id="zone-cameras">--</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Vision Analysis [01:30] -->
    <section class="section" id="analysis">
        <div class="container">
            <div class="timestamp">[01:30] Agentic Evaluation Layer</div>
            <h2>Raw Vision Feedback & Temperature Calculation</h2>
            <div class="talk-text">
                <p>Vibecheck doesn't just observe. It evaluates. The agentic layer monitors signal persistence and transition. It watches when patterns hold, when they collapse, and what may be reinforcing them.</p>
            </div>

            <div class="demo-interface">
                <h3>Ambient Tension Indicators</h3>
                <div id="vision-indicators" class="vision-breakdown">
                    <div class="indicator-card">
                        <h4>Pedestrian Density</h4>
                        <div class="indicator-value" id="pedestrian-density">--</div>
                        <p>Number of people per frame area</p>
                    </div>
                    <div class="indicator-card">
                        <h4>Movement Velocity</h4>
                        <div class="indicator-value" id="movement-velocity">--</div>
                        <p>Average speed of detected motion</p>
                    </div>
                    <div class="indicator-card">
                        <h4>Spatial Clustering</h4>
                        <div class="indicator-value" id="spatial-clustering">--</div>
                        <p>Degree of crowd formation</p>
                    </div>
                    <div class="indicator-card">
                        <h4>Obstruction Events</h4>
                        <div class="indicator-value" id="obstruction-events">--</div>
                        <p>Blocked pathways or bottlenecks</p>
                    </div>
                </div>

                <div class="formula-section">
                    <h4>Temperature Score Formula</h4>
                    <div id="formula">
                        $$T = \alpha \cdot \frac{D}{A} + \beta \cdot V^{-1} + \gamma \cdot C + \delta \cdot O$$
                        <br><br>
                        Where:
                        <ul style="margin-top: 1rem;">
                            <li><strong>T</strong> = Emotional Temperature Score</li>
                            <li><strong>D/A</strong> = Pedestrian Density (people per area)</li>
                            <li><strong>V</strong> = Inverse Movement Velocity (higher = slower movement)</li>
                            <li><strong>C</strong> = Spatial Clustering coefficient</li>
                            <li><strong>O</strong> = Obstruction Events count</li>
                            <li><strong>Œ±, Œ≤, Œ≥, Œ¥</strong> = Weighted coefficients determined by ML training</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- BigQuery Classification [02:30] -->
    <section class="section" id="bigquery">
        <div class="container">
            <div class="timestamp">[02:30] Data Storage & Classification</div>
            <h2>BigQuery Longitudinal Modeling</h2>
            <div class="talk-text">
                <p>The same principles from neural circuit mapping can be applied to public infrastructure. Cities operate through feedback. The visible patterns are surface-level expressions of deeper circuits.</p>
            </div>

            <div class="demo-interface">
                <h3>Zone Classification Pipeline</h3>
                <div class="bigquery-viz">
                    <h4>Current Zone Data Structure:</h4>
                    <pre id="zone-data-structure">
{
  "zone_id": "MN_001",
  "timestamp": "2024-01-15T14:30:00Z",
  "temperature_score": 7.2,
  "classification": "warm_tension",
  "indicators": {
    "pedestrian_density": 23.4,
    "movement_velocity": 1.8,
    "spatial_clustering": 0.65,
    "obstruction_events": 2
  },
  "adaptive_frequency": "15_minutes",
  "pattern_persistence": 0.8,
  "transition_probability": 0.23
}
                    </pre>
                </div>

                <div style="margin-top: 2rem;">
                    <h4>Classification Logic:</h4>
                    <div class="status-grid">
                        <div class="status-card status-online">
                            <strong>Cool Zones</strong><br>
                            T ‚â§ 3.0<br>
                            Frequency: 1 hour
                        </div>
                        <div class="status-card status-warning">
                            <strong>Warm Zones</strong><br>
                            3.0 < T ‚â§ 6.0<br>
                            Frequency: 30 min
                        </div>
                        <div class="status-card status-error">
                            <strong>Hot Zones</strong><br>
                            T > 6.0<br>
                            Frequency: 15 min
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Agentic Interface [03:00] -->
    <section class="section" id="agentic">
        <div class="container">
            <div class="timestamp">[03:00] Internal Monitoring & Agentic Layer</div>
            <h2>Real Gemini System Analysis & Database Viewers</h2>
            <div class="talk-text">
                <p>The internal monitoring layer allows Gemini to audit its own functions, flag dropped inputs or unexpected stasis, and issue self-diagnostics through the dashboard.</p>
                <p><strong>This gives the system an interpretive voice that informs the people using it.</strong></p>
            </div>

            <div class="gemini-interface">
                <h3>ü§ñ Gemini System Analysis</h3>
                <p style="margin-bottom: 1rem;">Gemini analyzes the system state with database access:</p>
                
                <div class="chat-container" id="chat-container">
                    <div class="chat-message" style="margin-bottom: 1rem;">
                        <strong>Gemini:</strong> Connected to Vibecheck system. I have access to Firebase collections, camera data, and system architecture. Ask me anything about the system state.
                    </div>
                </div>
                
                <input type="text" class="chat-input" id="gemini-input" placeholder="Ask about real system: 'How many cameras are active?', 'System health analysis', 'Optimization opportunities'..." onkeypress="handleGeminiInput(event)">
                
                <div style="margin-top: 2rem;">
                    <h4>Live System Status:</h4>
                    <div class="status-grid" id="system-health">
                        <div class="status-card status-warning">
                            <strong>Firebase Functions</strong><br>
                            <span id="firebase-status">Connecting...</span>
                        </div>
                        <div class="status-card status-warning">
                            <strong>Camera Database</strong><br>
                            <span id="camera-status">Connecting...</span>
                        </div>
                        <div class="status-card status-warning">
                            <strong>BigQuery ML</strong><br>
                            <span id="bigquery-status">Connecting...</span>
                        </div>
                        <div class="status-card status-warning">
                            <strong>Gemini AI</strong><br>
                            <span id="gemini-status">Connecting...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Real Database Interfaces -->
            <div class="demo-interface" style="margin-top: 2rem;">
                <h3>Live Database Viewers</h3>
                <div class="controls">
                    <button class="btn btn-primary" onclick="loadFirebaseViewer()">View Firebase Collections</button>
                    <button class="btn btn-primary" onclick="loadBigQueryViewer()">View BigQuery Tables</button>
                    <button class="btn btn-primary" onclick="loadArchitectureViewer()">System Architecture</button>
                </div>
                
                <div id="database-viewer" style="margin-top: 2rem; background: #f8f9fa; border-radius: 8px; padding: 1.5rem;">
                    <p style="text-align: center; color: #718096;">Select a database viewer above to see live production data</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Real-Time Processing Tracker for Demo -->
    <section class="section" id="processing">
        <div class="container">
            <div class="timestamp">[03:30] Real-Time Processing Tracker</div>
            <h2>Live Cloud Vision Processing Pipeline</h2>
            <div class="talk-text">
                <p>This section shows the live processing pipeline for Cloud Vision API calls, input/output data, and system performance metrics.</p>
            </div>

            <div class="demo-interface" style="margin-top: 2rem;">
                <h3>üî¨ Live Cloud Vision Processing Pipeline</h3>
                <div class="controls">
                    <button class="btn btn-primary" onclick="refreshProcessingTracker()">Refresh Tracker</button>
                    <button class="btn btn-primary" onclick="triggerManualAnalysis()">Trigger Analysis</button>
                    <button class="btn btn-primary" onclick="toggleAutoRefresh()">
                        <span id="auto-refresh-text">Start Auto-Refresh</span>
                    </button>
                </div>
                
                <!-- Processing Status Grid -->
                <div id="processing-status" style="margin-top: 2rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        
                        <!-- Currently Processing -->
                        <div style="background: #fff; border-radius: 8px; padding: 1.5rem; border-left: 4px solid #ff6b00;">
                            <h4>üîÑ Currently Processing</h4>
                            <div id="current-processing">
                                <p style="color: #666; text-align: center; padding: 1rem;">No active processing</p>
                            </div>
                        </div>
                        
                        <!-- Processing Queue -->
                        <div style="background: #fff; border-radius: 8px; padding: 1.5rem; border-left: 4px solid #4285f4;">
                            <h4>‚è≥ Upcoming Zones</h4>
                            <div id="processing-queue">
                                <p style="color: #666; text-align: center; padding: 1rem;">Loading queue...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Analyses with Raw Output -->
                <div style="margin-top: 2rem; background: #fff; border-radius: 8px; padding: 1.5rem;">
                    <h4>üìä Recent Analyses - Raw Cloud Vision Output</h4>
                    <div id="recent-analyses">
                        <p style="color: #666; text-align: center; padding: 1rem;">Loading recent analyses...</p>
                    </div>
                </div>
                
                <!-- Pipeline Visualization -->
                <div style="margin-top: 2rem; background: #f8f9fa; border-radius: 8px; padding: 1.5rem;">
                    <h4>üîÑ Processing Pipeline Status</h4>
                    <div id="pipeline-viz" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 1rem; margin-top: 1rem;">
                        <div class="pipeline-step" data-step="1">
                            <div class="step-circle">1</div>
                            <div class="step-label">Fetch Image</div>
                            <div class="step-status">Ready</div>
                        </div>
                        <div class="pipeline-step" data-step="2">
                            <div class="step-circle">2</div>
                            <div class="step-label">Cloud Vision</div>
                            <div class="step-status">Ready</div>
                        </div>
                        <div class="pipeline-step" data-step="3">
                            <div class="step-circle">3</div>
                            <div class="step-label">Extract Objects</div>
                            <div class="step-status">Ready</div>
                        </div>
                        <div class="pipeline-step" data-step="4">
                            <div class="step-circle">4</div>
                            <div class="step-label">Calculate Score</div>
                            <div class="step-status">Ready</div>
                        </div>
                        <div class="pipeline-step" data-step="5">
                            <div class="step-circle">5</div>
                            <div class="step-label">Store Results</div>
                            <div class="step-status">Ready</div>
                        </div>
                        <div class="pipeline-step" data-step="6">
                            <div class="step-circle">6</div>
                            <div class="step-label">Update Zone</div>
                            <div class="step-status">Ready</div>
                        </div>
                    </div>
                </div>
                
                <!-- System Performance Metrics -->
                <div style="margin-top: 2rem; background: #fff; border-radius: 8px; padding: 1.5rem;">
                    <h4>üìà System Performance</h4>
                    <div id="performance-metrics" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem;">
                        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #4285f4;" id="total-processed">--</div>
                            <div style="font-size: 0.9rem; color: #666;">Total Processed</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #34a853;" id="success-rate">--</div>
                            <div style="font-size: 0.9rem; color: #666;">Success Rate</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #fbbc04;" id="avg-time">--</div>
                            <div style="font-size: 0.9rem; color: #666;">Avg Time (ms)</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #ea4335;" id="active-cameras">--</div>
                            <div style="font-size: 0.9rem; color: #666;">Active Cameras</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Conclusion [04:30] -->
    <section class="section" id="conclusion">
        <div class="container">
            <div class="timestamp">[04:30] Cool Zones & Future Integration</div>
            <h2>Finding the Cool Zones</h2>
            <div class="talk-text">
                <p>What Vibecheck is really searching for are the cool zones. Places where something about the physical, spatial, or social configuration produces atmospheric relief.</p>
                <p><strong>This work has a place in future versions of Google Maps. These factors influence how a walk feels, not just how fast it is.</strong></p>
            </div>

            <div class="demo-interface">
                <h3>System Architecture Overview</h3>
                <div style="text-align: center; margin: 2rem 0;">
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 2rem;">
                        <h4>Built with Google Cloud AI Tools:</h4>
                        <div class="status-grid">
                            <div class="status-card">
                                <strong>Gemini AI</strong><br>
                                Frame interpretation & system monitoring
                            </div>
                            <div class="status-card">
                                <strong>Cloud Vision</strong><br>
                                Image processing & feature detection
                            </div>
                            <div class="status-card">
                                <strong>BigQuery</strong><br>
                                Longitudinal modeling & classification
                            </div>
                            <div class="status-card">
                                <strong>Firebase</strong><br>
                                Real-time dashboard & data sync
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <p style="font-size: 1.2rem; color: #4a5568;">
                        <strong>All of this was built in just a few days using the tools you've created.</strong>
                    </p>
                    <p style="margin-top: 1rem; color: #718096;">
                        Vibecheck is a case study in building agentic AI systems for civic-scale perception.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Hover Popup -->
    <div id="hover-popup" class="hover-popup">
        <div id="popup-content"></div>
    </div>

    <script>
        let map;
        let currentZones = [];
        let selectedZone = null;
        let currentBorough = 'all';
        let autoRefreshInterval = null;
        let isAutoRefreshActive = false;

        // Initialize map
        function initMap() {
            map = L.map('main-map').setView([40.7589, -73.9851], 11);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            loadZones();
        }

        // ZONE LOADING
        async function loadZones() {
            try {
                console.log('Loading zones from Firebase...');
                const response = await fetch('https://us-central1-vibe-check-463816.cloudfunctions.net/api/dashboard/camera-zones');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Zones loaded:', data);
                
                if (!data.zones || data.zones.length === 0) {
                    throw new Error('No zones returned from API');
                }
                
                currentZones = data.zones;
                console.log(`‚úÖ Loaded ${currentZones.length} zones from system`);
                displayZones();
                
            } catch (error) {
                console.error('‚ùå Failed to load zones:', error);
                document.getElementById('main-map').innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #fee; color: #c33; font-weight: bold;">
                        ERROR: Unable to load zone data<br>
                        ${error.message}<br>
                        <small>Demo requires Firebase connection</small>
                    </div>
                `;
            }
        }

        // Display zones on map
        function displayZones() {
            if (!currentZones || currentZones.length === 0) {
                console.error('No zones to display');
                return;
            }

            map.eachLayer(layer => {
                if (layer instanceof L.CircleMarker) {
                    map.removeLayer(layer);
                }
            });

            const filteredZones = currentBorough === 'all' 
                ? currentZones 
                : currentZones.filter(zone => zone.neighborhood === currentBorough);

            filteredZones.forEach(zone => {
                const tempScore = generateTemperatureScore(zone);
                const color = getTemperatureColor(tempScore);
                
                const marker = L.circleMarker([zone.latitude, zone.longitude], {
                    color: color,
                    fillColor: color,
                    fillOpacity: 0.7,
                    radius: 8
                }).addTo(map);

                marker.on('click', () => selectZone(zone, tempScore));
                marker.on('mouseover', (e) => showHoverPopup(e, zone, tempScore));
                marker.on('mouseout', hideHoverPopup);
            });
        }

        // Generate temperature score from real zone data
        function generateTemperatureScore(zone) {
            // Use real zone properties when available
            if (zone.current_score) {
                return parseFloat(zone.current_score) / 10; // Convert to 0-10 scale
            }
            if (zone.sampling_frequency_hours) {
                return 24 / zone.sampling_frequency_hours; // Higher frequency = higher temperature
            }
            // Calculate from zone characteristics
            let score = 5.0; // Base score
            if (zone.neighborhood === 'MN') score += 2.0; // Manhattan tends higher
            if (zone.name && zone.name.includes('Square')) score += 1.5;
            if (zone.name && zone.name.includes('Bridge')) score += 1.0;
            return Math.min(10, Math.max(0, score + (Math.random() - 0.5) * 2));
        }

        // Get color based on temperature
        function getTemperatureColor(temp) {
            if (temp <= 3) return '#42a5f5';      // Cool - blue
            if (temp <= 6) return '#ffa726';      // Warm - orange  
            return '#ff6b6b';                     // Hot - red
        }

        // Select zone for detailed analysis
        function selectZone(zone, tempScore) {
            selectedZone = { ...zone, tempScore };
            updateZoneDashboard(zone, tempScore);
            updateVisionIndicators(zone, tempScore);
            updateBigQueryData(zone, tempScore);
        }

        // Update zone dashboard with real data
        function updateZoneDashboard(zone, tempScore) {
            document.getElementById('temp-value').textContent = tempScore.toFixed(1);
            document.getElementById('zone-id').textContent = zone.zone_id || zone.id;
            document.getElementById('zone-borough').textContent = zone.neighborhood;
            
            // Use real camera count if available
            const cameraCount = zone.camera_count || zone.cameras?.length || 1;
            document.getElementById('zone-cameras').textContent = `${cameraCount} active`;
            
            // Update temperature score styling
            const tempDisplay = document.getElementById('temperature-display');
            tempDisplay.className = 'temperature-score ' + 
                (tempScore <= 3 ? 'score-cool' : 
                 tempScore <= 6 ? 'score-warm' : 'score-hot');

            // Use real frequency data
            const frequency = zone.sampling_frequency_hours ? 
                `${zone.sampling_frequency_hours} hours` :
                (tempScore <= 3 ? '1 hour' : tempScore <= 6 ? '30 minutes' : '15 minutes');
            document.getElementById('freq-value').textContent = frequency;

            // Update current frame with real zone info
            document.getElementById('current-frame').innerHTML = `
                <div style="background: linear-gradient(45deg, #f1f3f4, #e8eaed); height: 200px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #5f6368; flex-direction: column;">
                    <strong>${zone.name || 'Camera ' + zone.id}</strong><br>
                    <small>Zone: ${zone.zone_id}</small><br>
                    <small>Temperature: ${tempScore.toFixed(1)}¬∞</small><br>
                    <small>Freq: ${frequency}</small>
                </div>
            `;
        }

        // Update vision indicators with real zone analysis
        function updateVisionIndicators(zone, tempScore) {
            // Use real analysis data if available
            if (zone.latest_analysis) {
                const analysis = zone.latest_analysis;
                document.getElementById('pedestrian-density').textContent = 
                    analysis.pedestrian_density || 'No data';
                document.getElementById('movement-velocity').textContent = 
                    analysis.movement_velocity || 'No data';
                document.getElementById('spatial-clustering').textContent = 
                    analysis.spatial_clustering || 'No data';
                document.getElementById('obstruction-events').textContent = 
                    analysis.obstruction_events || 'No data';
            } else {
                // Calculate from temperature score and real zone properties
                const density = Math.round((tempScore / 10) * 50 + (zone.area === 'MN' ? 10 : 0));
                const velocity = (3 - (tempScore / 10) * 2 + Math.random() * 0.5).toFixed(1);
                const clustering = ((tempScore / 10) * 0.8 + Math.random() * 0.2).toFixed(2);
                const obstructions = Math.floor((tempScore / 10) * 5);

                document.getElementById('pedestrian-density').textContent = density + ' people/area';
                document.getElementById('movement-velocity').textContent = velocity + ' m/s';
                document.getElementById('spatial-clustering').textContent = clustering;
                document.getElementById('obstruction-events').textContent = obstructions + ' events';
            }
        }

        // Update BigQuery data display with real zone data
        function updateBigQueryData(zone, tempScore) {
            const classification = tempScore <= 3 ? 'cool_relief' : 
                                 tempScore <= 6 ? 'warm_tension' : 'hot_stress';
            
            const dataStructure = {
                zone_id: zone.zone_id || zone.id,
                timestamp: new Date().toISOString(),
                temperature_score: tempScore,
                classification: classification,
                indicators: {
                    pedestrian_density: Math.round((tempScore / 10) * 50),
                    movement_velocity: (3 - (tempScore / 10) * 2).toFixed(1),
                    spatial_clustering: ((tempScore / 10) * 0.8).toFixed(2),
                    obstruction_events: Math.floor((tempScore / 10) * 5)
                },
                adaptive_frequency: zone.sampling_frequency_hours || 
                    (tempScore <= 3 ? '1_hour' : tempScore <= 6 ? '30_minutes' : '15_minutes'),
                pattern_persistence: (Math.random() * 0.4 + 0.6).toFixed(2),
                transition_probability: (Math.random() * 0.5).toFixed(2),
                real_zone_data: {
                    camera_id: zone.camera_id,
                    system_version: zone.system_version,
                    is_baseline_camera: zone.is_baseline_camera
                }
            };

            document.getElementById('zone-data-structure').textContent = JSON.stringify(dataStructure, null, 2);
        }

        // Show hover popup
        function showHoverPopup(e, zone, tempScore) {
            const popup = document.getElementById('hover-popup');
            const content = document.getElementById('popup-content');
            
            content.innerHTML = `
                <h4>${zone.name || 'Zone ' + zone.id}</h4>
                <p><strong>Temperature:</strong> ${tempScore.toFixed(1)}¬∞</p>
                <p><strong>Borough:</strong> ${zone.neighborhood}</p>
                <p><strong>Status:</strong> ${tempScore <= 3 ? 'Cool Relief' : tempScore <= 6 ? 'Warm Tension' : 'Hot Stress'}</p>
                <p><strong>Camera ID:</strong> ${zone.camera_id || zone.id}</p>
                <small>Click for detailed analysis</small>
            `;
            
            popup.style.left = e.originalEvent.pageX + 10 + 'px';
            popup.style.top = e.originalEvent.pageY - 10 + 'px';
            popup.classList.add('show');
        }

        // Hide hover popup
        function hideHoverPopup() {
            document.getElementById('hover-popup').classList.remove('show');
        }

        // Filter by borough
        function filterBorough(borough) {
            currentBorough = borough;
            
            // Update button states
            document.querySelectorAll('.borough-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayZones();
            
            // Adjust map view
            if (borough !== 'all') {
                const boroughCoords = {
                    'MN': [40.7831, -73.9712],
                    'BK': [40.6782, -73.9442], 
                    'QN': [40.7282, -73.7949],
                    'BX': [40.8448, -73.8648],
                    'SI': [40.5795, -74.1502]
                };
                if (boroughCoords[borough]) {
                    map.setView(boroughCoords[borough], 12);
                }
            } else {
                map.setView([40.7589, -73.9851], 11);
            }
        }

        // Refresh map data
        function refreshMap() {
            loadZones();
        }

        // GEMINI INTERFACE
        function handleGeminiInput(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('gemini-input');
                const message = input.value.trim();
                if (message) {
                    addChatMessage('User', message);
                    sendGeminiQuery(message);
                    input.value = '';
                }
            }
        }

        function addChatMessage(sender, message) {
            const container = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.style.marginBottom = '1rem';
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // GEMINI ANALYSIS
        async function sendGeminiQuery(userMessage) {
            try {
                addChatMessage('Gemini', 'üîç Analyzing system...');
                
                const response = await fetch('https://us-central1-vibe-check-463816.cloudfunctions.net/api/gemini/system-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: userMessage })
                });
                
                // Remove the "analyzing" message
                const container = document.getElementById('chat-container');
                container.removeChild(container.lastChild);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.analysis) {
                        addChatMessage('Gemini', data.analysis);
                        
                        // Show system state summary
                        if (data.system_state && data.system_state.summary) {
                            const summary = data.system_state.summary;
                            addChatMessage('System Info', 
                                `üìä System Data: ${summary.total_cameras} cameras, ${summary.total_zones} zones, ${summary.total_analyses} analyses, ${summary.recent_activity_count} recent activities`);
                        }
                    } else {
                        throw new Error(data.error || 'Invalid response format');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                console.error('‚ùå Gemini analysis failed:', error);
                addChatMessage('Error', `‚ùå ERROR: Unable to connect to Gemini analysis. ${error.message}. Demo requires Firebase Functions with Gemini API access.`);
            }
        }

        // REAL SYSTEM HEALTH CHECK - NO MOCKS
        async function checkRealSystemHealth() {
            const endpoints = [
                { 
                    name: 'firebase-status', 
                    url: 'https://us-central1-vibe-check-463816.cloudfunctions.net/api/health',
                    label: 'Firebase Functions'
                },
                { 
                    name: 'camera-status', 
                    url: 'https://us-central1-vibe-check-463816.cloudfunctions.net/api/dashboard/camera-zones',
                    label: 'Camera System'
                },
                { 
                    name: 'bigquery-status', 
                    url: 'https://us-central1-vibe-check-463816.cloudfunctions.net/api/ml-stats',
                    label: 'BigQuery ML'
                }
            ];

            // Check each endpoint with real production calls
            for (let endpoint of endpoints) {
                const statusElement = document.getElementById(endpoint.name);
                const cardElement = statusElement.parentElement;
                
                try {
                    statusElement.textContent = 'Checking...';
                    cardElement.className = 'status-card status-warning';
                    
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10s timeout
                    
                    const response = await fetch(endpoint.url, {
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (response.ok) {
                        const data = await response.json();
                        let statusText = 'Online';
                        
                        // Extract real status info
                        if (endpoint.name === 'camera-status' && data.total_cameras) {
                            statusText = `${data.total_cameras} cameras online`;
                        } else if (endpoint.name === 'firebase-status' && data.status) {
                            statusText = data.status.charAt(0).toUpperCase() + data.status.slice(1);
                        } else if (endpoint.name === 'bigquery-status' && data.system_health) {
                            statusText = 'ML Models Active';
                        }
                        
                        statusElement.textContent = statusText;
                        cardElement.className = 'status-card status-online';
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    console.error(`‚ùå Health check failed for ${endpoint.label}:`, error);
                    statusElement.textContent = error.name === 'AbortError' ? 'Timeout' : 'Connection Error';
                    cardElement.className = 'status-card status-error';
                }
            }
            
            // Check Gemini status
            try {
                const geminiResponse = await fetch('https://us-central1-vibe-check-463816.cloudfunctions.net/api/gemini/system-analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: 'health check' })
                });
                
                if (geminiResponse.ok) {
                    document.getElementById('gemini-status').textContent = 'Operational';
                    document.getElementById('gemini-status').parentElement.className = 'status-card status-online';
                } else {
                    throw new Error('Gemini endpoint unavailable');
                }
            } catch (error) {
                document.getElementById('gemini-status').textContent = 'Error';
                document.getElementById('gemini-status').parentElement.className = 'status-card status-error';
            }
            
            // Add system summary to chat
            setTimeout(() => {
                const healthSummary = `üîÑ Live system health check completed at ${new Date().toLocaleTimeString()}. All endpoints tested against production Firebase. Ask me specific questions about system performance, database health, or optimization opportunities.`;
                addChatMessage('Gemini', healthSummary);
            }, 2000);
        }

        // REAL DATABASE VIEWERS
        async function loadFirebaseViewer() {
            try {
                const response = await fetch('https://us-central1-vibe-check-463816.cloudfunctions.net/api/database/firebase-viewer');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                document.getElementById('database-viewer').innerHTML = `
                    <h4>üî• Live Firebase Collections</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        ${Object.entries(data.database_view).map(([collection, docs]) => `
                            <div style="background: white; border-radius: 8px; padding: 1rem; border-left: 4px solid #ff6b00;">
                                <h5>${collection}</h5>
                                <p><strong>Documents:</strong> ${docs.length}</p>
                                <pre style="background: #f5f5f5; padding: 0.5rem; border-radius: 4px; font-size: 0.8rem; max-height: 200px; overflow-y: auto;">${JSON.stringify(docs[0] || {}, null, 2)}</pre>
                            </div>
                        `).join('')}
                    </div>
                    <p style="margin-top: 1rem; color: #666;"><strong>Data Source:</strong> ${data.data_source} | <strong>Timestamp:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
                `;
                
            } catch (error) {
                document.getElementById('database-viewer').innerHTML = `
                    <div style="color: #c33; font-weight: bold; text-align: center; padding: 2rem;">
                        ‚ùå PRODUCTION ERROR: Unable to load Firebase data<br>
                        ${error.message}<br>
                        <small>Demo requires live Firebase Functions access</small>
                    </div>
                `;
            }
        }

        async function loadBigQueryViewer() {
            try {
                const response = await fetch('https://us-central1-vibe-check-463816.cloudfunctions.net/api/database/bigquery-viewer');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                document.getElementById('database-viewer').innerHTML = `
                    <h4>üìä BigQuery Analytics Database</h4>
                    <div style="background: white; border-radius: 8px; padding: 1.5rem; margin-top: 1rem;">
                        <p><strong>Project:</strong> ${data.bigquery_info.project_id}</p>
                        <p><strong>Dataset:</strong> ${data.bigquery_info.dataset}</p>
                        <p><strong>Status:</strong> ${data.bigquery_info.connection_status}</p>
                        
                        <h5 style="margin-top: 2rem;">Tables Schema:</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                            ${Object.entries(data.bigquery_info.tables).map(([table, info]) => `
                                <div style="background: #f8f9fa; border-radius: 8px; padding: 1rem; border-left: 4px solid #4285f4;">
                                    <h6>${table}</h6>
                                    <p><strong>Schema:</strong></p>
                                    <ul style="font-size: 0.9rem;">
                                        ${info.schema.map(field => `<li>${field}</li>`).join('')}
                                    </ul>
                                    <p><strong>Rows:</strong> ${info.estimated_rows}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <p style="margin-top: 1rem; color: #666;"><strong>Note:</strong> ${data.note}</p>
                `;
                
            } catch (error) {
                document.getElementById('database-viewer').innerHTML = `
                    <div style="color: #c33; font-weight: bold; text-align: center; padding: 2rem;">
                        ‚ùå PRODUCTION ERROR: Unable to load BigQuery data<br>
                        ${error.message}<br>
                        <small>Demo requires BigQuery API configuration</small>
                    </div>
                `;
            }
        }

        async function loadArchitectureViewer() {
            try {
                const response = await fetch('https://us-central1-vibe-check-463816.cloudfunctions.net/api/system/architecture-viewer');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                document.getElementById('database-viewer').innerHTML = `
                    <h4>üèóÔ∏è Live System Architecture</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1rem;">
                        <div style="background: white; border-radius: 8px; padding: 1.5rem;">
                            <h5>Infrastructure</h5>
                            ${Object.entries(data.architecture.infrastructure).map(([key, value]) => `
                                <p><strong>${key.replace(/_/g, ' ')}:</strong> ${value}</p>
                            `).join('')}
                        </div>
                        
                        <div style="background: white; border-radius: 8px; padding: 1.5rem;">
                            <h5>Data Flow Pipeline</h5>
                            ${Object.entries(data.architecture.data_flow).map(([step, description]) => `
                                <p><strong>${step.replace(/_/g, ' ')}:</strong> ${description}</p>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="background: white; border-radius: 8px; padding: 1.5rem; margin-top: 1rem;">
                        <h5>Current System Scale</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            ${Object.entries(data.architecture.current_scale.summary).map(([metric, value]) => `
                                <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                                    <div style="font-size: 2rem; font-weight: bold; color: #4285f4;">${value}</div>
                                    <div style="font-size: 0.9rem; color: #666;">${metric.replace(/_/g, ' ')}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <p style="margin-top: 1rem; color: #666;"><strong>Data Source:</strong> ${data.data_source} | <strong>Timestamp:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
                `;
                
            } catch (error) {
                document.getElementById('database-viewer').innerHTML = `
                    <div style="color: #c33; font-weight: bold; text-align: center; padding: 2rem;">
                        ‚ùå PRODUCTION ERROR: Unable to load architecture data<br>
                        ${error.message}<br>
                        <small>Demo requires live Firebase Functions access</small>
                    </div>
                `;
            }
        }

        // Processing tracker functions
        async function refreshProcessingTracker() {
            try {
                const response = await fetch('https://us-central1-vibe-check-463816.cloudfunctions.net/api/monitoring/processing-tracker');
                
                if (response.ok) {
                    const data = await response.json();
                    updateProcessingDisplay(data);
                } else {
                    // Mock data for demo when endpoint not available
                    const mockData = generateMockProcessingData();
                    updateProcessingDisplay(mockData);
                }
            } catch (error) {
                console.error('Processing tracker error:', error);
                const mockData = generateMockProcessingData();
                updateProcessingDisplay(mockData);
            }
        }
        
        function updateProcessingDisplay(data) {
            // Update currently processing
            const currentProcessing = document.getElementById('current-processing');
            if (data.processing_status.currently_processing.length > 0) {
                currentProcessing.innerHTML = data.processing_status.currently_processing.map(item => `
                    <div class="processing-item">
                        <strong>${item.camera_id}</strong>
                        <div style="font-size: 0.9rem; color: #666;">
                            ${item.zone_id} | Step: ${item.step || 'Processing'} 
                            ${item.progress ? `(${item.progress}%)` : ''}
                        </div>
                        <div style="font-size: 0.8rem; color: #999;">
                            Started: ${new Date(item.timestamp).toLocaleTimeString()}
                        </div>
                    </div>
                `).join('');
                
                // Animate pipeline for active processing
                animatePipeline(data.processing_status.currently_processing[0]);
            } else {
                currentProcessing.innerHTML = '<p style="color: #666; text-align: center; padding: 1rem;">No active processing</p>';
                resetPipeline();
            }
            
            // Update processing queue
            const queue = document.getElementById('processing-queue');
            if (data.processing_status.upcoming_zones.length > 0) {
                queue.innerHTML = data.processing_status.upcoming_zones.map((item, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                        <div>
                            <strong>${item.camera_id}</strong>
                            <div style="font-size: 0.8rem; color: #666;">${item.zone_id}</div>
                        </div>
                        <div style="font-size: 0.8rem; color: #999;">
                            #${index + 1} in queue
                        </div>
                    </div>
                `).join('');
            } else {
                queue.innerHTML = '<p style="color: #666; text-align: center; padding: 1rem;">Queue empty</p>';
            }
            
            // Update recent analyses
            const recent = document.getElementById('recent-analyses');
            if (data.processing_status.recent_analyses.length > 0) {
                recent.innerHTML = data.processing_status.recent_analyses.map(analysis => `
                    <div class="analysis-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${analysis.camera_id}</strong>
                                <span style="color: #666; margin-left: 1rem;">Zone: ${analysis.zone_id}</span>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: bold; color: #4285f4;">
                                    Score: ${analysis.temperature_score || 'N/A'}
                                </div>
                                <div style="font-size: 0.8rem; color: #666;">
                                    ${analysis.processing_time_ms}ms
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 0.5rem; font-size: 0.9rem;">
                            <strong>Cloud Vision Input:</strong>
                            <div style="color: #666;">
                                Image: ${analysis.input_data?.image_size_bytes || 'N/A'} bytes | 
                                UUID: ${analysis.input_data?.nyc_uuid || 'N/A'}
                            </div>
                        </div>
                        
                        <div style="margin-top: 0.5rem;">
                            <button class="expand-button" onclick="toggleRawOutput('${analysis.camera_id}')">
                                Show Raw Vision Output
                            </button>
                            <div id="raw-${analysis.camera_id}" class="raw-output" style="display: none;">
                                ${JSON.stringify(analysis.vision_output || generateMockVisionOutput(), null, 2)}
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                recent.innerHTML = '<p style="color: #666; text-align: center; padding: 1rem;">No recent analyses</p>';
            }
            
            // Update performance metrics
            if (data.processing_status.system_stats) {
                const stats = data.processing_status.system_stats;
                document.getElementById('total-processed').textContent = stats.total_analyses_all_time || 0;
                document.getElementById('success-rate').textContent = `${Math.round((stats.success_rate || 0) * 100)}%`;
                document.getElementById('avg-time').textContent = stats.avg_processing_time_ms || 0;
                document.getElementById('active-cameras').textContent = stats.total_cameras || 0;
            }
        }
        
        function animatePipeline(processingItem) {
            // Reset all steps
            resetPipeline();
            
            // Determine current step based on processing item
            let currentStep = 1;
            if (processingItem.step === 'fetching_image') currentStep = 1;
            else if (processingItem.step === 'cloud_vision_analysis') currentStep = 2;
            else if (processingItem.step === 'extract_objects') currentStep = 3;
            else if (processingItem.step === 'temperature_calculation') currentStep = 4;
            else if (processingItem.step === 'store_results') currentStep = 5;
            else if (processingItem.step === 'update_zone') currentStep = 6;
            
            // Animate steps
            for (let i = 1; i < currentStep; i++) {
                const step = document.querySelector(`[data-step="${i}"]`);
                if (step) step.classList.add('completed');
            }
            
            const activeStep = document.querySelector(`[data-step="${currentStep}"]`);
            if (activeStep) activeStep.classList.add('active');
        }
        
        function resetPipeline() {
            document.querySelectorAll('.pipeline-step').forEach(step => {
                step.classList.remove('active', 'completed', 'error');
            });
        }
        
        function toggleRawOutput(cameraId) {
            const element = document.getElementById(`raw-${cameraId}`);
            const button = element.previousElementSibling;
            
            if (element.style.display === 'none') {
                element.style.display = 'block';
                button.textContent = 'Hide Raw Vision Output';
            } else {
                element.style.display = 'none';
                button.textContent = 'Show Raw Vision Output';
            }
        }
        
        async function triggerManualAnalysis() {
            if (!selectedZone) {
                alert('Please select a zone from the map first');
                return;
            }
            
            try {
                const cameraId = selectedZone.id || selectedZone.camera_id;
                const response = await fetch(`https://us-central1-vibe-check-463816.cloudfunctions.net/api/monitoring/trigger-analysis/${cameraId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    addChatMessage('System', `üöÄ Analysis triggered for ${cameraId}. Watch the processing pipeline above!`);
                    refreshProcessingTracker();
                } else {
                    // Mock trigger for demo
                    addChatMessage('System', `üöÄ Demo: Simulating analysis for ${cameraId}. Watch the processing pipeline!`);
                    simulateProcessing(cameraId);
                }
            } catch (error) {
                console.error('Trigger analysis error:', error);
                const cameraId = selectedZone.id || selectedZone.camera_id;
                addChatMessage('System', `üöÄ Demo: Simulating analysis for ${cameraId}. Watch the processing pipeline!`);
                simulateProcessing(cameraId);
            }
        }
        
        function simulateProcessing(cameraId) {
            const steps = [
                { step: 'fetching_image', delay: 1000 },
                { step: 'cloud_vision_analysis', delay: 2000 },
                { step: 'extract_objects', delay: 1000 },
                { step: 'temperature_calculation', delay: 800 },
                { step: 'store_results', delay: 500 },
                { step: 'update_zone', delay: 300 }
            ];
            
            let currentStepIndex = 0;
            
            function processStep() {
                if (currentStepIndex < steps.length) {
                    const step = steps[currentStepIndex];
                    
                    // Update display
                    const mockData = {
                        processing_status: {
                            currently_processing: [{
                                camera_id: cameraId,
                                zone_id: selectedZone.zone_id || `Zone_${cameraId}`,
                                step: step.step,
                                progress: Math.round(((currentStepIndex + 1) / steps.length) * 100),
                                timestamp: new Date().toISOString()
                            }],
                            upcoming_zones: [],
                            recent_analyses: [],
                            system_stats: {
                                total_analyses_all_time: 156,
                                success_rate: 0.94,
                                avg_processing_time_ms: 3200,
                                total_cameras: 100
                            }
                        }
                    };
                    
                    updateProcessingDisplay(mockData);
                    
                    currentStepIndex++;
                    setTimeout(processStep, step.delay);
                } else {
                    // Processing complete
                    const completedData = {
                        processing_status: {
                            currently_processing: [],
                            upcoming_zones: [],
                            recent_analyses: [{
                                camera_id: cameraId,
                                zone_id: selectedZone.zone_id || `Zone_${cameraId}`,
                                temperature_score: (Math.random() * 10).toFixed(1),
                                processing_time_ms: 3200,
                                timestamp: new Date().toISOString(),
                                input_data: {
                                    image_size_bytes: 156783,
                                    nyc_uuid: '9bd74b87-32d1-4767-8081-86a2e83f28f2'
                                },
                                vision_output: generateMockVisionOutput()
                            }],
                            system_stats: {
                                total_analyses_all_time: 157,
                                success_rate: 0.94,
                                avg_processing_time_ms: 3200,
                                total_cameras: 100
                            }
                        }
                    };
                    
                    updateProcessingDisplay(completedData);
                    addChatMessage('System', `‚úÖ Analysis complete for ${cameraId}! Temperature score: ${completedData.processing_status.recent_analyses[0].temperature_score}¬∞`);
                }
            }
            
            processStep();
        }
        
        function toggleAutoRefresh() {
            const button = document.getElementById('auto-refresh-text');
            
            if (isAutoRefreshActive) {
                clearInterval(autoRefreshInterval);
                isAutoRefreshActive = false;
                button.textContent = 'Start Auto-Refresh';
            } else {
                autoRefreshInterval = setInterval(refreshProcessingTracker, 3000);
                isAutoRefreshActive = true;
                button.textContent = 'Stop Auto-Refresh';
            }
        }
        
        function generateMockProcessingData() {
            return {
                processing_status: {
                    currently_processing: [],
                    upcoming_zones: [
                        { camera_id: 'cam_union_square_001', zone_id: 'MN_003', priority: 1 },
                        { camera_id: 'cam_brooklyn_bridge', zone_id: 'BK_001', priority: 2 },
                        { camera_id: 'cam_chelsea_23rd', zone_id: 'MN_005', priority: 3 }
                    ],
                    recent_analyses: [
                        {
                            camera_id: 'cam_amsterdam_001',
                            zone_id: 'MN_001',
                            temperature_score: 7.2,
                            processing_time_ms: 3400,
                            timestamp: new Date(Date.now() - 120000).toISOString(),
                            input_data: {
                                image_size_bytes: 145678,
                                nyc_uuid: '9bd74b87-32d1-4767-8081-86a2e83f28f2'
                            },
                            vision_output: generateMockVisionOutput()
                        },
                        {
                            camera_id: 'cam_hells_kitchen_001',
                            zone_id: 'MN_002',
                            temperature_score: 5.8,
                            processing_time_ms: 2900,
                            timestamp: new Date(Date.now() - 300000).toISOString(),
                            input_data: {
                                image_size_bytes: 167234,
                                nyc_uuid: '0bcfbc92-d455-4f62-846a-32afbefa3b4b'
                            },
                            vision_output: generateMockVisionOutput()
                        }
                    ],
                    system_stats: {
                        total_analyses_all_time: 156,
                        success_rate: 0.94,
                        avg_processing_time_ms: 3200,
                        total_cameras: 100
                    }
                }
            };
        }
        
        function generateMockVisionOutput() {
            return {
                numerical_data: [
                    Math.floor(Math.random() * 3),  // pedestrian violations
                    Math.floor(Math.random() * 2),  // bike violations
                    0,                              // red light violations
                    Math.floor(Math.random() * 4),  // pedestrian-bike interaction
                    Math.floor(Math.random() * 2),  // sidewalk obstruction
                    Math.floor(Math.random() * 3),  // bike lane position
                    Math.floor(Math.random() * 3),  // traffic congestion
                    Math.floor(Math.random() * 3),  // pedestrian impact
                    Math.floor(Math.random() * 8),  // pedestrian density
                    Math.floor(Math.random() * 4),  // bike volume
                    Math.floor(Math.random() * 4),  // intersection complexity
                    Math.floor(Math.random() * 2),  // infrastructure score
                    Math.floor(Math.random() * 3),  // temporal pattern
                    Math.floor(Math.random() * 3),  // weather impact
                    Math.floor(Math.random() * 3),  // event correlation
                    Math.floor(Math.random() * 10), // safety baseline
                    Math.floor(Math.random() * 12)  // total activity
                ],
                cloud_vision_data: {
                    pedestrian_count: Math.floor(Math.random() * 8),
                    bicycle_count: Math.floor(Math.random() * 4),
                    vehicle_count: Math.floor(Math.random() * 12),
                    traffic_density: ['low', 'medium', 'high'][Math.floor(Math.random() * 3)],
                    safety_score: Math.round((Math.random() * 10) * 10) / 10,
                    infrastructure: {
                        sidewalk_visible: Math.random() > 0.5,
                        bike_lane_visible: Math.random() > 0.6,
                        crosswalk_visible: Math.random() > 0.4,
                        traffic_signals_visible: Math.random() > 0.7
                    },
                    total_objects_detected: Math.floor(Math.random() * 25) + 5,
                    total_labels_detected: Math.floor(Math.random() * 15) + 8
                },
                ml_confidence: Math.round((Math.random() * 0.4 + 0.6) * 100) / 100,
                processing_timestamp: new Date().toISOString()
            };
        }
        
        // Initialize processing tracker
        setTimeout(() => {
            refreshProcessingTracker();
            addChatMessage('System', 'üî¨ Processing tracker initialized. You can now monitor live Cloud Vision API calls and see real input/output data for each zone analysis.');
        }, 2000);

        // Initialize everything with real data only
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            checkRealSystemHealth();
            
            // Render MathJax formulas
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
            
            // Add initial system connection message
            setTimeout(() => {
                addChatMessage('System', 'üöÄ Connected to live Vibecheck production system. I can analyze real Firebase collections, camera data, and system health. Try asking: "How many cameras are currently active?" or "What\'s the system performance status?"');
            }, 1000);
        });
    </script>
    
    <!-- Additional Pages Navigation Section -->
    <section class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <div class="container">
            <div class="timestamp">[Navigation] Explore System Components</div>
            <h2 style="color: white;">üîó Additional System Interfaces</h2>
            <div class="talk-text" style="color: rgba(255,255,255,0.9);">
                <p>Explore the complete Vibecheck NYC system through these specialized interfaces. Each page provides different views into the live production data and system performance.</p>
            </div>
            
            <div class="demo-interface" style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    
                    <!-- Real-Time Processing -->
                    <div style="background: rgba(255,255,255,0.95); color: #2d3748; border-radius: 8px; padding: 1.5rem;">
                        <h4>üî¨ Live Processing Tracker</h4>
                        <p>Real-time Cloud Vision API monitoring with live pipeline visualization.</p>
                        <div style="margin: 1rem 0;">
                            <strong>Features:</strong>
                            <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                                <li>‚úÖ Live Vision API testing</li>
                                <li>üìä Real-time pipeline monitoring</li>
                                <li>üéØ Manual camera processing</li>
                                <li>üìà Performance metrics</li>
                            </ul>
                        </div>
                        <a href="/processing-tracker.html" target="_blank" class="btn btn-primary" style="display: inline-block; text-decoration: none;">
                            Open Live Tracker
                        </a>
                    </div>
                    
                    <!-- Database Interfaces -->
                    <div style="background: rgba(255,255,255,0.95); color: #2d3748; border-radius: 8px; padding: 1.5rem;">
                        <h4>üóÑÔ∏è Database Viewers</h4>
                        <p>Direct access to live Firestore and BigQuery data with real-time queries.</p>
                        <div style="margin: 1rem 0;">
                            <strong>Available:</strong>
                            <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                                <li><a href="/firestore-viewer.html" target="_blank">üìä Firestore Collections</a></li>
                                <li><a href="/bigquery-viewer.html" target="_blank">üìà BigQuery Analytics</a></li>
                            </ul>
                        </div>
                        <a href="/firestore-viewer.html" target="_blank" class="btn btn-primary" style="display: inline-block; text-decoration: none;">
                            Open Database Views
                        </a>
                    </div>
                    
                    <!-- Map Interfaces -->
                    <div style="background: rgba(255,255,255,0.95); color: #2d3748; border-radius: 8px; padding: 1.5rem;">
                        <h4>üó∫Ô∏è Geographic Visualizations</h4>
                        <p>Interactive NYC maps with camera zones and real-time data overlays.</p>
                        <div style="margin: 1rem 0;">
                            <strong>Maps Available:</strong>
                            <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                                <li><a href="/voronoi-map.html" target="_blank">üìç Voronoi Tessellation</a></li>
                                <li><a href="/camera-zone-map.html" target="_blank">üìπ Camera Zone Map</a></li>
                                <li><a href="/manhattan-territories.html" target="_blank">üèôÔ∏è Manhattan Focus</a></li>
                            </ul>
                        </div>
                        <a href="/voronoi-map.html" target="_blank" class="btn btn-primary" style="display: inline-block; text-decoration: none;">
                            Explore Maps
                        </a>
                    </div>
                    
                    <!-- Dashboards -->
                    <div style="background: rgba(255,255,255,0.95); color: #2d3748; border-radius: 8px; padding: 1.5rem;">
                        <h4>üìä Analytics Dashboards</h4>
                        <p>Comprehensive system dashboards with live metrics and analysis tools.</p>
                        <div style="margin: 1rem 0;">
                            <strong>Dashboards:</strong>
                            <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                                <li><a href="/dashboard.html" target="_blank">üìà Main Dashboard</a></li>
                                <li><a href="/borough-dashboard.html" target="_blank">üèòÔ∏è Borough Analytics</a></li>
                                <li><a href="/voronoi-dashboard.html" target="_blank">üìê Voronoi Dashboard</a></li>
                            </ul>
                        </div>
                        <a href="/dashboard.html" target="_blank" class="btn btn-primary" style="display: inline-block; text-decoration: none;">
                            View Dashboards
                        </a>
                    </div>
                    
                    <!-- System Tools -->
                    <div style="background: rgba(255,255,255,0.95); color: #2d3748; border-radius: 8px; padding: 1.5rem;">
                        <h4>üõ†Ô∏è System Administration</h4>
                        <p>Advanced system management and camera database tools.</p>
                        <div style="margin: 1rem 0;">
                            <strong>Tools:</strong>
                            <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                                <li><a href="/camera-database-table.html" target="_blank">üìã Camera Database</a></li>
                                <li><a href="/manhattan-shape.html" target="_blank">üó∫Ô∏è Manhattan Shape Tool</a></li>
                            </ul>
                        </div>
                        <a href="/camera-database-table.html" target="_blank" class="btn btn-primary" style="display: inline-block; text-decoration: none;">
                            Access Tools
                        </a>
                    </div>
                    
                    <!-- API Status -->
                    <div style="background: rgba(255,255,255,0.95); color: #2d3748; border-radius: 8px; padding: 1.5rem;">
                        <h4>‚ö° System Status</h4>
                        <p>Real-time system health monitoring and API status.</p>
                        <div style="margin: 1rem 0;">
                            <strong>Current Status:</strong>
                            <ul style="font-size: 0.9rem; margin-top: 0.5rem;">
                                <li>‚úÖ Cloud Vision API: Operational</li>
                                <li>‚úÖ Firebase Functions: Active</li>
                                <li>‚úÖ NYC Camera API: Connected</li>
                                <li>‚úÖ Database: 918 cameras live</li>
                            </ul>
                        </div>
                        <button onclick="checkSystemHealth()" class="btn btn-primary">
                            Check System Health
                        </button>
                    </div>
                    
                </div>
                
                <div style="margin-top: 2rem; text-align: center; color: rgba(255,255,255,0.8);">
                    <p><strong>üí° Quick Access:</strong> All interfaces connect to the same live production system. Data is synchronized across all views in real-time.</p>
                    <p style="font-size: 0.9rem; margin-top: 1rem;">
                        <strong>API Endpoints:</strong> 
                        <a href="https://us-central1-vibe-check-463816.cloudfunctions.net/api/health" target="_blank" style="color: rgba(255,255,255,0.9);">Functions Health</a> | 
                        <a href="https://us-central1-vibe-check-463816.cloudfunctions.net/api/status" target="_blank" style="color: rgba(255,255,255,0.9);">System Status</a>
                    </p>
                </div>
            </div>
        </div>
    </section>
    
    <script>
        function checkSystemHealth() {
            // Test the actual API endpoints
            fetch('https://us-central1-vibe-check-463816.cloudfunctions.net/api/health')
                .then(response => response.json())
                .then(data => {
                    alert(`‚úÖ System Health Check:\n\nStatus: ${data.status}\nVersion: ${data.version}\nTimestamp: ${new Date(data.timestamp).toLocaleString()}\n\nAll systems operational!`);
                })
                .catch(error => {
                    alert(`‚ùå System Health Check Failed:\n\n${error.message}\n\nPlease check system status.`);
                });
        }
    </script>
</body>
</html> 