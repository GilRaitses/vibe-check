<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe-Check: NYC AI Urban Intelligence System</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.8em; margin: 0; }
        .borough-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin: 30px 0;
        }
        .borough-card {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .borough-card:hover { background: rgba(255,255,255,0.25); transform: translateY(-2px); }
        .borough-code { font-size: 2em; color: #FFD700; }
        .zone-analytics {
            background: rgba(0,0,0,0.3);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
        }
        .zone-analytics.active { display: block; }
        .analytics-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9em;
        }
        .analytics-table th {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid rgba(255,255,255,0.3);
        }
        .analytics-table td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .analytics-table tr:hover { background: rgba(255,255,255,0.1); }
        .stress-indicator {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .stress-low { background: #4CAF50; color: white; }
        .stress-medium { background: #FF9800; color: white; }
        .stress-high { background: #F44336; color: white; }
        .sampling-freq {
            background: rgba(135, 206, 235, 0.3);
            padding: 4px 8px;
            border-radius: 8px;
            color: #87CEEB;
        }
        .image-viewer {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        .load-image-btn {
            background: #FFD700;
            color: #333;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        .load-image-btn:hover { background: #FFF; }
        .camera-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .system-stats {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number { font-size: 2em; color: #FFD700; }
        .filters {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .filter-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            margin: 5px;
            cursor: pointer;
        }
        .filter-btn.active { background: #FFD700; color: #333; }
        .timestamp { color: #90EE90; font-size: 0.8em; }
        .zone-id { font-family: monospace; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèôÔ∏è Vibe-Check NYC AI Intelligence</h1>
            <p><strong>Real-time Urban Navigation Intelligence System</strong></p>
            <p>940 Cameras ‚Ä¢ 907 AI Zones ‚Ä¢ Live ML Analysis</p>
        </div>
        
        <div class="system-stats">
            <div class="stat-card">
                <div class="stat-number">329</div>
                <div>Manhattan Zones</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">202</div>
                <div>Brooklyn Zones</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">204</div>
                <div>Queens Zones</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">95</div>
                <div>Staten Island Zones</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">77</div>
                <div>Bronx Zones</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="active-zones">0</div>
                <div>Active Analysis</div>
            </div>
        </div>
        
        <div class="borough-grid">
            <div class="borough-card" onclick="loadBorough('MN')">
                <div class="borough-code">MN</div>
                <div>Manhattan</div>
                <div>329 zones</div>
            </div>
            <div class="borough-card" onclick="loadBorough('BK')">
                <div class="borough-code">BK</div>
                <div>Brooklyn</div>
                <div>202 zones</div>
            </div>
            <div class="borough-card" onclick="loadBorough('QN')">
                <div class="borough-code">QN</div>
                <div>Queens</div>
                <div>204 zones</div>
            </div>
            <div class="borough-card" onclick="loadBorough('SI')">
                <div class="borough-code">SI</div>
                <div>Staten Island</div>
                <div>95 zones</div>
            </div>
            <div class="borough-card" onclick="loadBorough('BX')">
                <div class="borough-code">BX</div>
                <div>Bronx</div>
                <div>77 zones</div>
            </div>
        </div>
        
        <div id="zone-analytics" class="zone-analytics">
            <div class="filters">
                <h3>üîç Zone Analytics Filters</h3>
                <button class="filter-btn active" onclick="filterZones('all')">All Zones</button>
                <button class="filter-btn" onclick="filterZones('high-stress')">High Stress</button>
                <button class="filter-btn" onclick="filterZones('frequent-sampling')">Frequent Sampling</button>
                <button class="filter-btn" onclick="filterZones('recent-analysis')">Recently Analyzed</button>
            </div>
            
            <table class="analytics-table" id="analytics-table">
                <thead>
                    <tr>
                        <th>Zone ID</th>
                        <th>Camera Location</th>
                        <th>Stress Level</th>
                        <th>Violation Rate</th>
                        <th>Sampling Freq.</th>
                        <th>Last Analysis</th>
                        <th>Current Image</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="analytics-tbody">
                    <!-- Data populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div class="image-viewer" id="image-viewer" style="display: none;">
            <h3>üì∑ Live Camera Feed</h3>
            <div id="image-container">
                <p>Select a zone to load current camera image</p>
            </div>
            <div class="timestamp" id="image-timestamp"></div>
        </div>
    </div>
    
    <script>
        const FIREBASE_API_BASE = 'https://us-central1-vibe-check-463816.cloudfunctions.net/api';
        let currentBorough = null;
        let zoneData = {};
        
        // Sample zone data structure (in production, this would come from API)
        const mockZoneData = {
            'MN_001': {
                zone_id: 'MN_001',
                camera_name: 'Broadway @ 46 Street',
                stress_level: 'medium',
                violation_rate: 0.23,
                sampling_freq: '30min',
                last_analysis: '2024-06-24 17:45:32',
                coordinates: [-74.0010637153985, 40.761978792937]
            },
            'MN_002': {
                zone_id: 'MN_002',
                camera_name: 'Broadway @ 46 St- Quad South',
                stress_level: 'low',
                violation_rate: 0.12,
                sampling_freq: '2hr',
                last_analysis: '2024-06-24 16:30:15',
                coordinates: [-74.161351, 40.529434]
            },
            'BK_042': {
                zone_id: 'BK_042',
                camera_name: 'BQE @ Sands St (eastbound)',
                stress_level: 'high',
                violation_rate: 0.45,
                sampling_freq: '15min',
                last_analysis: '2024-06-24 17:50:08',
                coordinates: [-73.909282, 40.844785]
            }
        };
        
        async function loadBorough(borough) {
            currentBorough = borough;
            
            // Show analytics section
            document.getElementById('zone-analytics').classList.add('active');
            
            // Update header
            const boroughNames = {
                'MN': 'Manhattan',
                'BK': 'Brooklyn', 
                'QN': 'Queens',
                'SI': 'Staten Island',
                'BX': 'Bronx'
            };
            
            try {
                // Load zone data from Firebase Functions
                await loadZoneData(borough);
                displayZoneAnalytics(borough);
                
                // Update active zones counter
                updateActiveZonesCount();
                
            } catch (error) {
                console.error('Error loading borough data:', error);
                displayMockData(borough);
            }
        }
        
        async function loadZoneData(borough) {
            // In production, this would fetch from zone lookup and analytics APIs
            const response = await fetch(`${FIREBASE_API_BASE}/get-metrics/${borough}_001`);
            const data = await response.json();
            console.log('Zone data loaded:', data);
        }
        
        function displayZoneAnalytics(borough) {
            const tbody = document.getElementById('analytics-tbody');
            tbody.innerHTML = '';
            
            // Generate sample data for demonstration
            const zones = generateSampleZones(borough);
            
            zones.forEach(zone => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="zone-id">${zone.zone_id}</span></td>
                    <td>${zone.camera_name}</td>
                    <td><span class="stress-indicator stress-${zone.stress_level}">${zone.stress_level.toUpperCase()}</span></td>
                    <td>${(zone.violation_rate * 100).toFixed(1)}%</td>
                    <td><span class="sampling-freq">${zone.sampling_freq}</span></td>
                    <td><span class="timestamp">${zone.last_analysis}</span></td>
                    <td><span class="timestamp">${zone.image_timestamp || 'N/A'}</span></td>
                    <td>
                        <button class="load-image-btn" onclick="loadZoneImage('${zone.zone_id}')">
                            üì∑ Load Image
                        </button>
                        <button class="load-image-btn" onclick="testZoneAPI('${zone.zone_id}')">
                            üîó Test API
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function generateSampleZones(borough) {
            const zoneCounts = { 'MN': 329, 'BK': 202, 'QN': 204, 'SI': 95, 'BX': 77 };
            const count = Math.min(zoneCounts[borough] || 50, 25); // Show first 25 zones
            const zones = [];
            
            for (let i = 1; i <= count; i++) {
                const zoneNum = String(i).padStart(3, '0');
                const zone_id = `${borough}_${zoneNum}`;
                
                zones.push({
                    zone_id: zone_id,
                    camera_name: `${borough} Camera ${i} - ${generateLocationName()}`,
                    stress_level: ['low', 'medium', 'high'][Math.floor(Math.random() * 3)],
                    violation_rate: Math.random() * 0.6,
                    sampling_freq: ['15min', '30min', '1hr', '2hr', '4hr'][Math.floor(Math.random() * 5)],
                    last_analysis: generateRecentTimestamp(),
                    image_timestamp: generateRecentTimestamp()
                });
            }
            
            return zones;
        }
        
        function generateLocationName() {
            const streets = ['Broadway', 'Park Ave', 'Main St', 'Union St', 'Court St', 'Atlantic Ave'];
            const numbers = ['42nd', '14th', '125th', '86th', '23rd', '59th'];
            return `${streets[Math.floor(Math.random() * streets.length)]} @ ${numbers[Math.floor(Math.random() * numbers.length)]}`;
        }
        
        function generateRecentTimestamp() {
            const now = new Date();
            const minutesAgo = Math.floor(Math.random() * 120); // Up to 2 hours ago
            const timestamp = new Date(now.getTime() - minutesAgo * 60000);
            return timestamp.toISOString().slice(0, 19).replace('T', ' ');
        }
        
        async function loadZoneImage(zoneId) {
            const imageViewer = document.getElementById('image-viewer');
            const imageContainer = document.getElementById('image-container');
            const imageTimestamp = document.getElementById('image-timestamp');
            
            imageViewer.style.display = 'block';
            imageContainer.innerHTML = '<p>üîÑ Loading camera image...</p>';
            
            try {
                // Simulate loading image from proxy server
                setTimeout(() => {
                    const mockImageUrl = `data:image/svg+xml;base64,${btoa(`
                        <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
                            <rect width="400" height="300" fill="#2a2a2a"/>
                            <text x="200" y="150" text-anchor="middle" fill="white" font-size="16">
                                üì∑ ${zoneId} Live Feed
                            </text>
                            <text x="200" y="170" text-anchor="middle" fill="#FFD700" font-size="12">
                                Simulated Camera Image
                            </text>
                            <circle cx="100" cy="100" r="20" fill="#FF6B6B"/>
                            <circle cx="300" cy="200" r="15" fill="#4ECDC4"/>
                            <rect x="50" y="250" width="300" height="30" fill="#45B7D1" opacity="0.7"/>
                        </svg>
                    `)}`;
                    
                    imageContainer.innerHTML = `
                        <img src="${mockImageUrl}" class="camera-image" alt="Camera ${zoneId}">
                        <div>
                            <strong>Zone:</strong> ${zoneId} | 
                            <strong>Status:</strong> <span style="color: #90EE90">Active</span> |
                            <strong>Resolution:</strong> 1920x1080
                        </div>
                    `;
                    
                    imageTimestamp.textContent = `üìÖ Image captured: ${new Date().toISOString().slice(0, 19).replace('T', ' ')} UTC`;
                }, 1000);
                
            } catch (error) {
                imageContainer.innerHTML = `<p>‚ùå Error loading image: ${error.message}</p>`;
            }
        }
        
        async function testZoneAPI(zoneId) {
            try {
                const response = await fetch(`${FIREBASE_API_BASE}/get-metrics/${zoneId}`);
                const data = await response.json();
                
                alert(`üîó API Test Results for ${zoneId}:\n\n${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                alert(`‚ùå API Error: ${error.message}`);
            }
        }
        
        function filterZones(filter) {
            // Update filter button states
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const rows = document.querySelectorAll('#analytics-tbody tr');
            
            rows.forEach(row => {
                let show = true;
                
                switch(filter) {
                    case 'high-stress':
                        show = row.querySelector('.stress-high') !== null;
                        break;
                    case 'frequent-sampling':
                        show = row.textContent.includes('15min') || row.textContent.includes('30min');
                        break;
                    case 'recent-analysis':
                        const timestamp = row.querySelector('.timestamp').textContent;
                        const analysisTime = new Date(timestamp);
                        const now = new Date();
                        show = (now - analysisTime) < 60 * 60 * 1000; // Within 1 hour
                        break;
                    default:
                        show = true;
                }
                
                row.style.display = show ? '' : 'none';
            });
        }
        
        function updateActiveZonesCount() {
            const activeCount = Math.floor(Math.random() * 50) + 150;
            document.getElementById('active-zones').textContent = activeCount;
        }
        
        // Initialize with Manhattan
        setTimeout(() => loadBorough('MN'), 1000);
        
        // Update stats periodically
        setInterval(updateActiveZonesCount, 5000);
    </script>
</body>
</html> 